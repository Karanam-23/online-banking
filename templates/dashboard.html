{% extends "base.html" %}
{% block content %}
<div class="grid md:grid-cols-3 gap-6">

  <div class="col-span-2">
    <div class="flex items-center justify-between mb-4">
      <div>
        <div class="h2">Accounts</div>
        <div class="kv">Overview & quick actions</div>
      </div>
      <div class="flex gap-2">
        <a class="btn btn-ghost" href="{{ url_for('transfer') }}">Transfer</a>
        <a class="btn btn-gold" href="{{ url_for('virtual_card') }}">Create Card</a>
      </div>
    </div>

    <div class="grid grid-cols-2 gap-4">
      {% for a in accounts %}
      <div class="card">
        <div class="kv">Account</div>
        <div class="font-bold">{{ a.number }}</div>
        <div class="mt-2 text-2xl">₹ {{ "%.2f"|format(a.balance) }}</div>
      </div>
      {% endfor %}
    </div>

    <div class="mt-6 card">
      <div class="h2">Recent transactions</div>
      <div class="mt-3">
        {% for t in recent %}
          <div class="flex justify-between py-2 border-t">
            <div>
              <div class="font-semibold">{{ t.type }} • {{ t.note or '' }}</div>
              <div class="small muted">{{ t.created_at }}</div>
            </div>
            <div>
              <div class="{{ 'text-red-600' if t.amount<0 else '' }}">{{ '₹' ~ ('%.2f'|format(t.amount)) }}</div>
            </div>
          </div>
        {% else %}
          <div class="muted p-4">No recent transactions.</div>
        {% endfor %}
      </div>
    </div>
  </div>

  <div>
    <div class="card-ghost">
      <div class="h2">Budget summary</div>
      <div class="mt-4">
        <canvas id="budgetChart" width="300" height="300"></canvas>
      </div>
      <div class="mt-4 small muted">Quick spending breakdown</div>
    </div>
  </div>
</div>

<script>
  const ctx = document.getElementById('budgetChart');
  if (ctx) {
    new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: {{ categories.keys()|list|tojson }},
        datasets: [{
          data: {{ categories.values()|list|tojson }},
          backgroundColor: ['#6C2BD9','#4B1AA6','#F3C623','#EFE6FF','#1A1A1A']
        }]
      },
      options: { responsive:true, maintainAspectRatio:false }
    });
  }
</script>
{% endblock %}
